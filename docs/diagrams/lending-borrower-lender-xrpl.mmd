%%{init: {"flowchart": {"htmlLabels": true}, "markdownAutoWrap": false, "themeCSS": ".edgeLabel, .edgeLabel span, .edgeLabel p { white-space: nowrap !important; max-width: none !important; }"}}%%
flowchart TB
    B[Borrower User]
    X1[(XRP Ledger)]

    subgraph P[Lending Platform]
        direction LR
        API[Lending API]
        ENG[Risk Engine]
        DB[(Lending State DB)]
        API <--> |Borrow/withdraw validation| ENG
        API <--> |Read/write positions and events| DB
        ENG --> |Store risk outcomes| DB
    end

    X2[(XRP Ledger)]
    L["Lender User (Bank)"]

    B <--> |Deposit/Withdraw&nbsp;collateral and &nbsp;Borrow/Repay&nbsp;loan| X1
    X1 <--> |Confirm&nbsp;tx&nbsp;hash&nbsp;+&nbsp;settlement&nbsp;status| P
    P <--> |Accured&nbsp;yields&nbsp;/&nbsp;collateral&nbsp;liquidations| X2
    X2 <--> |Supply&nbsp;loan&nbsp;assets&nbsp;/&nbsp;seize&nbsp;collateral| L

    style B fill:#eef7ff,stroke:#2563eb,stroke-width:1.5px
    style X1 fill:#ecfdf5,stroke:#047857,stroke-width:1.5px
    style X2 fill:#ecfdf5,stroke:#047857,stroke-width:1.5px
    style API fill:#f5f3ff,stroke:#6d28d9,stroke-width:1.5px
    style ENG fill:#fff7ed,stroke:#c2410c,stroke-width:1.5px
    style DB fill:#f9fafb,stroke:#374151,stroke-width:1.5px
